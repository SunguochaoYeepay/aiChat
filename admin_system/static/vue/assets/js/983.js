"use strict";(self["webpackChunkdesign_helper_frontend"]=self["webpackChunkdesign_helper_frontend"]||[]).push([[983],{2983:(e,a,l)=>{l.r(a),l.d(a,{default:()=>I});var t=l(6254),i=l(8627);const r={class:"api-key-manager-container"},o={class:"key-display"},n={class:"key-actions"};function d(e,a,l,d,s,c){const p=(0,t.g2)("plus-outlined"),u=(0,t.g2)("a-button"),v=(0,t.g2)("a-tag"),y=(0,t.g2)("a-popconfirm"),m=(0,t.g2)("a-space"),_=(0,t.g2)("a-table"),b=(0,t.g2)("a-input"),f=(0,t.g2)("a-form-item"),k=(0,t.g2)("a-textarea"),F=(0,t.g2)("a-date-picker"),A=(0,t.g2)("a-input-number"),h=(0,t.g2)("a-form"),g=(0,t.g2)("a-modal"),w=(0,t.g2)("a-checkbox"),K=(0,t.g2)("a-input-password"),I=(0,t.g2)("a-card");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.bF)(I,{title:"API密钥管理",bordered:!1},{extra:(0,t.k6)((()=>[(0,t.bF)(u,{type:"primary",onClick:e.showCreateModal},{icon:(0,t.k6)((()=>[(0,t.bF)(p)])),default:(0,t.k6)((()=>[a[15]||(a[15]=(0,t.eW)(" 创建API密钥 "))])),_:1},8,["onClick"])])),default:(0,t.k6)((()=>[(0,t.bF)(_,{columns:e.columns,"data-source":e.apiKeys,loading:e.loading,pagination:{pageSize:10},rowKey:"id"},{bodyCell:(0,t.k6)((({column:l,record:r})=>["is_active"===l.dataIndex?((0,t.uX)(),(0,t.Wv)(v,{key:0,color:r.is_active?"green":"red"},{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(r.is_active?"激活":"禁用"),1)])),_:2},1032,["color"])):"action"===l.dataIndex?((0,t.uX)(),(0,t.Wv)(m,{key:1},{default:(0,t.k6)((()=>[(0,t.bF)(u,{type:"link",onClick:a=>e.copyApiKey(r)},{default:(0,t.k6)((()=>a[16]||(a[16]=[(0,t.eW)("复制")]))),_:2},1032,["onClick"]),(0,t.bF)(u,{type:"link",onClick:a=>e.showEditModal(r)},{default:(0,t.k6)((()=>a[17]||(a[17]=[(0,t.eW)("编辑")]))),_:2},1032,["onClick"]),(0,t.bF)(y,{title:"确定要删除这个API密钥吗？","ok-text":"确定","cancel-text":"取消",onConfirm:a=>e.deleteApiKey(r)},{default:(0,t.k6)((()=>[(0,t.bF)(u,{type:"link",danger:""},{default:(0,t.k6)((()=>a[18]||(a[18]=[(0,t.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,t.Q3)("",!0)])),_:1},8,["columns","data-source","loading"]),(0,t.bF)(g,{visible:e.createModalVisible,"onUpdate:visible":a[5]||(a[5]=a=>e.createModalVisible=a),title:"创建API密钥",onOk:e.handleCreateApiKey,confirmLoading:e.modalLoading},{default:(0,t.k6)((()=>[(0,t.bF)(h,{model:e.apiKeyForm,rules:e.rules,ref:"createFormRef",layout:"vertical"},{default:(0,t.k6)((()=>[(0,t.bF)(f,{label:"名称",name:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(b,{value:e.apiKeyForm.name,"onUpdate:value":a[0]||(a[0]=a=>e.apiKeyForm.name=a),placeholder:"请输入API密钥名称"},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"描述",name:"description"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{value:e.apiKeyForm.description,"onUpdate:value":a[1]||(a[1]=a=>e.apiKeyForm.description=a),placeholder:"请输入描述",rows:"4"},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"过期时间",name:"expires_at"},{default:(0,t.k6)((()=>[(0,t.bF)(F,{value:e.apiKeyForm.expires_at,"onUpdate:value":a[2]||(a[2]=a=>e.apiKeyForm.expires_at=a),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择过期时间（可选）",style:{width:"100%"}},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"允许的IP地址",name:"allowed_ips"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{value:e.apiKeyForm.allowed_ips,"onUpdate:value":a[3]||(a[3]=a=>e.apiKeyForm.allowed_ips=a),placeholder:"请输入允许的IP地址，多个IP用逗号分隔（可选）",rows:"2"},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"速率限制（每分钟请求数）",name:"rate_limit_override"},{default:(0,t.k6)((()=>[(0,t.bF)(A,{value:e.apiKeyForm.rate_limit_override,"onUpdate:value":a[4]||(a[4]=a=>e.apiKeyForm.rate_limit_override=a),placeholder:"留空表示使用接口默认限制",style:{width:"100%"}},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onOk","confirmLoading"]),(0,t.bF)(g,{visible:e.editModalVisible,"onUpdate:visible":a[12]||(a[12]=a=>e.editModalVisible=a),title:"编辑API密钥",onOk:e.handleUpdateApiKey,confirmLoading:e.modalLoading},{default:(0,t.k6)((()=>[(0,t.bF)(h,{model:e.apiKeyForm,rules:e.rules,ref:"editFormRef",layout:"vertical"},{default:(0,t.k6)((()=>[(0,t.bF)(f,{label:"名称",name:"name"},{default:(0,t.k6)((()=>[(0,t.bF)(b,{value:e.apiKeyForm.name,"onUpdate:value":a[6]||(a[6]=a=>e.apiKeyForm.name=a),placeholder:"请输入API密钥名称"},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"描述",name:"description"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{value:e.apiKeyForm.description,"onUpdate:value":a[7]||(a[7]=a=>e.apiKeyForm.description=a),placeholder:"请输入描述",rows:"4"},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"过期时间",name:"expires_at"},{default:(0,t.k6)((()=>[(0,t.bF)(F,{value:e.apiKeyForm.expires_at,"onUpdate:value":a[8]||(a[8]=a=>e.apiKeyForm.expires_at=a),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择过期时间（可选）",style:{width:"100%"}},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"允许的IP地址",name:"allowed_ips"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{value:e.apiKeyForm.allowed_ips,"onUpdate:value":a[9]||(a[9]=a=>e.apiKeyForm.allowed_ips=a),placeholder:"请输入允许的IP地址，多个IP用逗号分隔（可选）",rows:"2"},null,8,["value"])])),_:1}),(0,t.bF)(f,{label:"速率限制（每分钟请求数）",name:"rate_limit_override"},{default:(0,t.k6)((()=>[(0,t.bF)(A,{value:e.apiKeyForm.rate_limit_override,"onUpdate:value":a[10]||(a[10]=a=>e.apiKeyForm.rate_limit_override=a),placeholder:"留空表示使用接口默认限制",style:{width:"100%"}},null,8,["value"])])),_:1}),(0,t.bF)(f,{name:"is_active"},{default:(0,t.k6)((()=>[(0,t.bF)(w,{checked:e.apiKeyForm.is_active,"onUpdate:checked":a[11]||(a[11]=a=>e.apiKeyForm.is_active=a)},{default:(0,t.k6)((()=>a[19]||(a[19]=[(0,t.eW)("激活")]))),_:1},8,["checked"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onOk","confirmLoading"]),(0,t.bF)(g,{visible:e.keyDisplayModalVisible,"onUpdate:visible":a[14]||(a[14]=a=>e.keyDisplayModalVisible=a),title:"API密钥创建成功",closable:!1,maskClosable:!1,footer:null},{default:(0,t.k6)((()=>[(0,t.Lk)("div",o,[a[21]||(a[21]=(0,t.Lk)("p",{class:"warning-text"},"⚠️ 请记下您的API密钥，此密钥只会显示一次！",-1)),(0,t.bF)(K,{value:e.newApiKey,"onUpdate:value":a[13]||(a[13]=a=>e.newApiKey=a),readonly:"",addonAfter:e.copyAddon},null,8,["value","addonAfter"]),(0,t.Lk)("div",n,[(0,t.bF)(u,{type:"primary",onClick:e.handleApiKeyCopied},{default:(0,t.k6)((()=>a[20]||(a[20]=[(0,t.eW)(" 我已复制密钥 ")]))),_:1},8,["onClick"])])])])),_:1},8,["visible"])])),_:1})])}var s=l(5598),c=l(3163),p=l(5870),u={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"};const v=u;var y=l(5419);function m(e){for(var a=1;a<arguments.length;a++){var l=null!=arguments[a]?Object(arguments[a]):{},t=Object.keys(l);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(l).filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})))),t.forEach((function(a){_(e,a,l[a])}))}return e}function _(e,a,l){return a in e?Object.defineProperty(e,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[a]=l,e}var b=function(e,a){var l=m({},e,a.attrs);return(0,t.bF)(y.A,m({},l,{icon:v}),null)};b.displayName="CopyOutlined",b.inheritAttrs=!1;const f=b;var k=l(6357);const F=()=>k.A.get("/v1/api-keys"),A=e=>k.A.post("/v1/api-keys/create",e),h=(e,a)=>k.A.put(`/v1/api-keys/${e}/update`,a),g=(0,t.pM)({name:"ApiKeyManager",components:{PlusOutlined:p.A,CopyOutlined:f},setup(){const e=(0,s.KR)([]),a=(0,s.KR)(!1),l=(0,s.KR)(!1),i=(0,s.KR)(!1),r=(0,s.KR)(!1),o=(0,s.KR)(!1),n=(0,s.KR)(null),d=(0,s.KR)(""),p=(0,s.KR)(null),u=(0,s.KR)(null),v=[{title:"ID",dataIndex:"id",key:"id"},{title:"名称",dataIndex:"name",key:"name"},{title:"API密钥",dataIndex:"key",key:"key"},{title:"状态",dataIndex:"is_active",key:"is_active"},{title:"创建时间",dataIndex:"created_at",key:"created_at"},{title:"调用次数",dataIndex:"call_count",key:"call_count"},{title:"操作",dataIndex:"action",key:"action"}],y=(0,s.Kh)({name:"",description:"",expires_at:null,allowed_ips:"",rate_limit_override:null,is_active:!0}),m={name:[{required:!0,message:"请输入API密钥名称",trigger:"blur"}]},_=(0,t.h)(f,{onClick:()=>{navigator.clipboard.writeText(d.value).then((()=>c.Ay.success("API密钥已复制到剪贴板"))).catch((()=>c.Ay.error("复制失败，请手动复制")))}}),b=async()=>{a.value=!0;try{const a=await F();e.value=a.data.api_keys}catch(l){console.error("获取API密钥列表失败:",l),c.Ay.error("获取API密钥列表失败")}finally{a.value=!1}},k=()=>{w(),l.value=!0},g=e=>{w(),n.value=e.id,y.name=e.name,y.description=e.description||"",y.expires_at=e.expires_at?new Date(e.expires_at):null,y.allowed_ips=e.allowed_ips||"",y.rate_limit_override=e.rate_limit_override,y.is_active=e.is_active,i.value=!0},w=()=>{y.name="",y.description="",y.expires_at=null,y.allowed_ips="",y.rate_limit_override=null,y.is_active=!0,n.value=null},K=async()=>{try{await p.value.validate(),o.value=!0;const e={name:y.name,description:y.description,is_active:y.is_active};y.expires_at&&(e.expires_at=y.expires_at.toISOString()),y.allowed_ips&&(e.allowed_ips=y.allowed_ips),y.rate_limit_override&&(e.rate_limit_override=y.rate_limit_override);const a=await A(e);d.value=a.data.api_key,l.value=!1,r.value=!0}catch(e){e.response&&e.response.data?c.Ay.error(e.response.data.error||"创建API密钥失败"):e.message?console.error("表单验证失败",e):c.Ay.error("创建API密钥失败")}finally{o.value=!1}},I=async()=>{try{await u.value.validate(),o.value=!0;const e={name:y.name,description:y.description,is_active:y.is_active};y.expires_at&&(e.expires_at=y.expires_at.toISOString()),y.allowed_ips&&(e.allowed_ips=y.allowed_ips),y.rate_limit_override&&(e.rate_limit_override=y.rate_limit_override),await h(n.value,e),c.Ay.success("更新API密钥成功"),i.value=!1,b()}catch(e){e.response&&e.response.data?c.Ay.error(e.response.data.error||"更新API密钥失败"):e.message?console.error("表单验证失败",e):c.Ay.error("更新API密钥失败")}finally{o.value=!1}},P=async e=>{a.value=!0;try{await P(e.id),c.Ay.success(`API密钥 ${e.name} 已删除`),b()}catch(l){l.response&&l.response.data?c.Ay.error(l.response.data.error||"删除API密钥失败"):c.Ay.error("删除API密钥失败")}finally{a.value=!1}},x=e=>{navigator.clipboard.writeText(e.key).then((()=>c.Ay.success("API密钥已复制到剪贴板"))).catch((()=>c.Ay.error("复制失败，请手动复制")))},O=()=>{r.value=!1,b(),c.Ay.success("API密钥创建成功")};return(0,t.sV)((()=>{b()})),{apiKeys:e,loading:a,columns:v,apiKeyForm:y,rules:m,createModalVisible:l,editModalVisible:i,keyDisplayModalVisible:r,modalLoading:o,newApiKey:d,copyAddon:_,createFormRef:p,editFormRef:u,showCreateModal:k,showEditModal:g,handleCreateApiKey:K,handleUpdateApiKey:I,deleteApiKey:P,copyApiKey:x,handleApiKeyCopied:O}}});var w=l(4093);const K=(0,w.A)(g,[["render",d],["__scopeId","data-v-29741828"]]),I=K},5870:(e,a,l)=>{l.d(a,{A:()=>c});var t=l(6254),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"};const r=i;var o=l(5419);function n(e){for(var a=1;a<arguments.length;a++){var l=null!=arguments[a]?Object(arguments[a]):{},t=Object.keys(l);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(l).filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})))),t.forEach((function(a){d(e,a,l[a])}))}return e}function d(e,a,l){return a in e?Object.defineProperty(e,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[a]=l,e}var s=function(e,a){var l=n({},e,a.attrs);return(0,t.bF)(o.A,n({},l,{icon:r}),null)};s.displayName="PlusOutlined",s.inheritAttrs=!1;const c=s}}]);
//# sourceMappingURL=983.js.map