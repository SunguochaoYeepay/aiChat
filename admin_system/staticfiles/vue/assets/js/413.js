"use strict";(self["webpackChunkdesign_helper_frontend"]=self["webpackChunkdesign_helper_frontend"]||[]).push([[413],{3413:(e,a,t)=>{t.r(a),t.d(a,{default:()=>x});var n=t(6254),l=t(8627);const i={class:"knowledge-base"},d={class:"page-title"},o={class:"action-buttons"},s={style:{"margin-bottom":"16px"}},u={key:0,style:{"max-height":"100px",overflow:"auto"}},c={class:"knowledge-content-preview"},r={key:0,style:{"max-height":"100px",overflow:"auto"}},k={class:"ant-upload-drag-icon"};function g(e,a,t,g,y,b){const v=(0,n.g2)("a-button"),h=(0,n.g2)("a-popconfirm"),m=(0,n.g2)("a-space"),p=(0,n.g2)("a-table"),_=(0,n.g2)("a-tab-pane"),w=(0,n.g2)("a-select-option"),f=(0,n.g2)("a-select"),C=(0,n.g2)("a-tag"),x=(0,n.g2)("a-tabs"),F=(0,n.g2)("a-card"),K=(0,n.g2)("a-modal"),A=(0,n.g2)("a-spin"),L=(0,n.g2)("a-icon"),W=(0,n.g2)("a-upload-dragger"),R=(0,n.g2)("a-form-item"),I=(0,n.g2)("a-divider"),M=(0,n.g2)("a-input"),U=(0,n.g2)("a-form"),V=(0,n.g2)("a-textarea");return(0,n.uX)(),(0,n.CE)("div",i,[(0,n.Lk)("div",d,[a[12]||(a[12]=(0,n.Lk)("h2",null,"知识库管理",-1)),a[13]||(a[13]=(0,n.Lk)("p",{class:"sub-title"},"管理系统的知识库文档和分块",-1)),(0,n.Lk)("div",o,[(0,n.bF)(v,{type:"primary",onClick:g.importKnowledge,style:{"margin-right":"8px"}},{default:(0,n.k6)((()=>a[10]||(a[10]=[(0,n.eW)("导入知识")]))),_:1},8,["onClick"]),(0,n.bF)(v,{type:"default",onClick:g.refreshKnowledgeBases},{default:(0,n.k6)((()=>a[11]||(a[11]=[(0,n.eW)("刷新")]))),_:1},8,["onClick"])])]),(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(x,{activeKey:g.activeTab,"onUpdate:activeKey":a[1]||(a[1]=e=>g.activeTab=e)},{default:(0,n.k6)((()=>[(0,n.bF)(_,{key:"knowledge",tab:"知识库管理"},{default:(0,n.k6)((()=>[(0,n.bF)(p,{columns:g.columns,"data-source":g.knowledgeList,loading:g.loading,"row-key":"id"},{bodyCell:(0,n.k6)((({column:e,record:t})=>["actions"===e.key?((0,n.uX)(),(0,n.Wv)(m,{key:0},{default:(0,n.k6)((()=>[(0,n.bF)(v,{type:"link",onClick:e=>g.viewContent(t)},{default:(0,n.k6)((()=>a[14]||(a[14]=[(0,n.eW)("查看内容")]))),_:2},1032,["onClick"]),(0,n.bF)(v,{type:"link",onClick:e=>g.viewChunks(t)},{default:(0,n.k6)((()=>a[15]||(a[15]=[(0,n.eW)("查看分块")]))),_:2},1032,["onClick"]),(0,n.bF)(v,{type:"link",onClick:e=>g.indexKnowledge(t.id),disabled:t.is_indexed},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(t.is_indexed?"已向量化":"向量化"),1)])),_:2},1032,["onClick","disabled"]),(0,n.bF)(h,{title:"确定要删除此知识库?",onConfirm:e=>g.deleteKnowledge(t.id),"ok-text":"确定","cancel-text":"取消"},{default:(0,n.k6)((()=>[(0,n.bF)(v,{type:"link",danger:""},{default:(0,n.k6)((()=>a[16]||(a[16]=[(0,n.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source","loading"])])),_:1}),(0,n.bF)(_,{key:"chunks",tab:"分块管理"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",s,[(0,n.bF)(f,{value:g.selectedKnowledgeBase,"onUpdate:value":a[0]||(a[0]=e=>g.selectedKnowledgeBase=e),placeholder:"选择知识库",style:{width:"300px","margin-right":"16px"},onChange:g.loadChunks},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(g.knowledgeList,(e=>((0,n.uX)(),(0,n.Wv)(w,{key:e.id,value:e.id},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","onChange"]),(0,n.bF)(v,{type:"primary",onClick:g.loadChunks,disabled:!g.selectedKnowledgeBase},{default:(0,n.k6)((()=>a[17]||(a[17]=[(0,n.eW)("加载分块")]))),_:1},8,["onClick","disabled"])]),(0,n.bF)(p,{columns:g.chunkColumns,"data-source":g.chunksList,loading:g.chunksLoading,"row-key":"id"},{bodyCell:(0,n.k6)((({column:e,record:t})=>["content"===e.key?((0,n.uX)(),(0,n.CE)("div",u,(0,l.v_)(t.content),1)):(0,n.Q3)("",!0),"is_indexed"===e.key?((0,n.uX)(),(0,n.Wv)(C,{key:1,color:t.is_indexed?"green":"red"},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(t.is_indexed?"已向量化":"未向量化"),1)])),_:2},1032,["color"])):(0,n.Q3)("",!0),"actions"===e.key?((0,n.uX)(),(0,n.Wv)(m,{key:2},{default:(0,n.k6)((()=>[(0,n.bF)(v,{type:"link",onClick:e=>g.editChunk(t)},{default:(0,n.k6)((()=>a[18]||(a[18]=[(0,n.eW)("编辑")]))),_:2},1032,["onClick"]),(0,n.bF)(v,{type:"link",onClick:e=>g.vectorizeChunk(t.id),disabled:t.is_indexed},{default:(0,n.k6)((()=>a[19]||(a[19]=[(0,n.eW)(" 向量化 ")]))),_:2},1032,["onClick","disabled"]),(0,n.bF)(h,{title:"确定要删除此分块?",onConfirm:e=>g.deleteChunk(t.id),"ok-text":"确定","cancel-text":"取消"},{default:(0,n.k6)((()=>[(0,n.bF)(v,{type:"link",danger:""},{default:(0,n.k6)((()=>a[20]||(a[20]=[(0,n.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source","loading"])])),_:1})])),_:1},8,["activeKey"])])),_:1}),(0,n.bF)(K,{visible:g.contentModalVisible,"onUpdate:visible":a[2]||(a[2]=e=>g.contentModalVisible=e),title:g.currentKnowledge.name,width:"800px",footer:null},{default:(0,n.k6)((()=>[(0,n.Lk)("div",c,[(0,n.Lk)("pre",null,(0,l.v_)(g.currentKnowledge.content),1)])])),_:1},8,["visible","title"]),(0,n.bF)(K,{visible:g.chunksModalVisible,"onUpdate:visible":a[3]||(a[3]=e=>g.chunksModalVisible=e),title:`${g.currentKnowledge.name} - 分块管理`,width:"900px",footer:null},{default:(0,n.k6)((()=>[(0,n.bF)(A,{spinning:g.chunksLoading},{default:(0,n.k6)((()=>[(0,n.bF)(p,{columns:g.chunkColumns,"data-source":g.knowledgeChunks,pagination:{pageSize:5}},{bodyCell:(0,n.k6)((({column:e,record:t})=>["content"===e.key?((0,n.uX)(),(0,n.CE)("div",r,(0,l.v_)(t.content),1)):(0,n.Q3)("",!0),"is_indexed"===e.key?((0,n.uX)(),(0,n.Wv)(C,{key:1,color:t.is_indexed?"green":"red"},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(t.is_indexed?"已向量化":"未向量化"),1)])),_:2},1032,["color"])):(0,n.Q3)("",!0),"actions"===e.key?((0,n.uX)(),(0,n.Wv)(m,{key:2},{default:(0,n.k6)((()=>[(0,n.bF)(v,{type:"link",size:"small",onClick:e=>g.editChunk(t)},{default:(0,n.k6)((()=>a[21]||(a[21]=[(0,n.eW)("编辑")]))),_:2},1032,["onClick"]),(0,n.bF)(v,{type:"link",size:"small",onClick:e=>g.vectorizeChunk(t.id),disabled:t.is_indexed},{default:(0,n.k6)((()=>a[22]||(a[22]=[(0,n.eW)(" 向量化 ")]))),_:2},1032,["onClick","disabled"]),(0,n.bF)(h,{title:"确定要删除此分块?",onConfirm:e=>g.deleteChunk(t.id),"ok-text":"确定","cancel-text":"取消"},{default:(0,n.k6)((()=>[(0,n.bF)(v,{type:"link",danger:"",size:"small"},{default:(0,n.k6)((()=>a[23]||(a[23]=[(0,n.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source"])])),_:1},8,["spinning"])])),_:1},8,["visible","title"]),(0,n.bF)(K,{visible:g.importModalVisible,"onUpdate:visible":a[5]||(a[5]=e=>g.importModalVisible=e),title:"导入知识库",onOk:g.submitImport,confirmLoading:g.importLoading},{default:(0,n.k6)((()=>[(0,n.bF)(U,{layout:"vertical"},{default:(0,n.k6)((()=>[(0,n.bF)(R,{label:"从文件导入"},{default:(0,n.k6)((()=>[(0,n.bF)(W,{name:"file",multiple:!1,"before-upload":g.beforeUpload,"custom-request":g.customUploadRequest},{default:(0,n.k6)((()=>[(0,n.Lk)("p",k,[(0,n.bF)(L,{type:"inbox"})]),a[24]||(a[24]=(0,n.Lk)("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域上传",-1)),a[25]||(a[25]=(0,n.Lk)("p",{class:"ant-upload-hint"},"支持上传 Markdown 文件",-1))])),_:1},8,["before-upload","custom-request"])])),_:1}),(0,n.bF)(I,null,{default:(0,n.k6)((()=>a[26]||(a[26]=[(0,n.eW)("或者")]))),_:1}),(0,n.bF)(R,{label:"从目录导入"},{default:(0,n.k6)((()=>[(0,n.bF)(M,{value:g.importDirectory,"onUpdate:value":a[4]||(a[4]=e=>g.importDirectory=e),placeholder:"请输入知识库文件所在目录的绝对路径"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","onOk","confirmLoading"]),(0,n.bF)(K,{visible:g.editChunkModalVisible,"onUpdate:visible":a[9]||(a[9]=e=>g.editChunkModalVisible=e),title:"编辑知识库分块",onOk:g.saveChunk,confirmLoading:g.saveChunkLoading,width:"800px"},{default:(0,n.k6)((()=>[(0,n.bF)(U,{layout:"vertical"},{default:(0,n.k6)((()=>[g.editingChunk.knowledge_base?((0,n.uX)(),(0,n.Wv)(R,{key:0,label:"所属知识库"},{default:(0,n.k6)((()=>[(0,n.bF)(M,{value:g.editingChunk.knowledge_base_name,"onUpdate:value":a[6]||(a[6]=e=>g.editingChunk.knowledge_base_name=e),disabled:""},null,8,["value"])])),_:1})):(0,n.Q3)("",!0),(0,n.bF)(R,{label:"分块内容"},{default:(0,n.k6)((()=>[(0,n.bF)(V,{value:g.editingChunk.content,"onUpdate:value":a[7]||(a[7]=e=>g.editingChunk.content=e),rows:10,placeholder:"请输入分块内容..."},null,8,["value"])])),_:1}),(0,n.bF)(R,{label:"元数据"},{default:(0,n.k6)((()=>[(0,n.bF)(M,{value:g.editingChunk.metadata_str,"onUpdate:value":a[8]||(a[8]=e=>g.editingChunk.metadata_str=e),placeholder:"元数据 (JSON 格式)"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","onOk","confirmLoading"])])}var y=t(5598),b=t(3163),v=t(6327),h=t(6357);const m="/api/v1/chunks/",p={getChunks(e=null){let a=m;return e&&(a+=`?knowledge_base=${e}`),h.A.get(a)},getChunk(e){return h.A.get(`${m}${e}/`)},createChunk(e){return h.A.post(m,e)},updateChunk(e,a){return h.A.put(`${m}${e}/`,a)},deleteChunk(e){return h.A.delete(`${m}${e}/`)},vectorizeChunk(e){return h.A.post(`${m}${e}/vectorize/`)}},_=p,w={name:"KnowledgeBase",setup(){const e=(0,y.KR)(!1),a=(0,y.KR)(!1),t=(0,y.KR)([]),l=(0,y.KR)([]),i=(0,y.KR)([]),d=(0,y.KR)(!1),o=(0,y.KR)(!1),s=(0,y.KR)(!1),u=(0,y.KR)(!1),c=(0,y.KR)(!1),r=(0,y.KR)(!1),k=(0,y.KR)(""),g=(0,y.KR)("knowledge"),h=(0,y.KR)(null),m=(0,y.Kh)({id:null,name:"",content:""}),p=(0,y.Kh)({id:null,knowledge_base:null,knowledge_base_name:"",content:"",is_indexed:!1,metadata:{},metadata_str:"{}"}),w=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"知识库名称",dataIndex:"name",key:"name",width:200},{title:"描述",dataIndex:"description",key:"description",width:300},{title:"文件路径",dataIndex:"file_path",key:"file_path",width:300},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",width:180},{title:"操作",key:"actions",width:280}],f=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"内容",dataIndex:"content",key:"content",ellipsis:!0},{title:"向量化状态",dataIndex:"is_indexed",key:"is_indexed",width:100},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:180},{title:"操作",key:"actions",width:200}],C=async()=>{e.value=!0;try{const e=await v.A.getKnowledgeBases();t.value=e.data||[]}catch(a){b.Ay.error("加载知识库列表失败: "+a.message)}finally{e.value=!1}},x=()=>{C()},F=async e=>{try{const a=await v.A.getKnowledgeBase(e.id),t=a.data;m.id=t.id,m.name=t.name,m.content=t.content,d.value=!0}catch(a){b.Ay.error("获取知识库内容失败: "+a.message)}},K=async e=>{m.id=e.id,m.name=e.name,o.value=!0,await A(e.id)},A=async e=>{a.value=!0;try{const a=await _.getChunks(e);i.value=a.data||[]}catch(t){b.Ay.error("加载知识库分块失败: "+t.message)}finally{a.value=!1}},L=async()=>{if(h.value){a.value=!0;try{const e=await _.getChunks(h.value);l.value=e.data||[]}catch(e){b.Ay.error("加载分块失败: "+e.message)}finally{a.value=!1}}else l.value=[]},W=async e=>{try{const a=await v.A.indexKnowledgeBase(e);"success"===a.data.status?(b.Ay.success(a.data.message||"知识库向量化成功"),C()):b.Ay.error(a.data.message||"知识库向量化失败")}catch(a){b.Ay.error("向量化知识库失败: "+a.message)}},R=async e=>{try{await v.A.deleteKnowledgeBase(e),b.Ay.success("知识库删除成功"),C()}catch(a){b.Ay.error("删除知识库失败: "+a.message)}},I=e=>{p.id=e.id,p.knowledge_base=e.knowledge_base;const a=t.value.find((a=>a.id===e.knowledge_base));p.knowledge_base_name=a?a.name:`知识库 #${e.knowledge_base}`,p.content=e.content,p.is_indexed=e.is_indexed,p.metadata=e.metadata||{},p.metadata_str=JSON.stringify(e.metadata||{},null,2),u.value=!0},M=async()=>{r.value=!0;try{let a={};try{a=JSON.parse(p.metadata_str)}catch(e){return b.Ay.error("元数据必须是有效的 JSON 格式"),void(r.value=!1)}await _.updateChunk(p.id,{knowledge_base:p.knowledge_base,content:p.content,metadata:a}),b.Ay.success("分块更新成功"),u.value=!1,o.value&&await A(m.id),"chunks"===g.value&&await L()}catch(a){b.Ay.error("更新分块失败: "+a.message)}finally{r.value=!1}},U=async e=>{try{const a=await _.vectorizeChunk(e);"success"===a.data.status?(b.Ay.success(a.data.message||"分块向量化成功"),o.value&&await A(m.id),"chunks"===g.value&&await L()):b.Ay.error(a.data.message||"分块向量化失败")}catch(a){b.Ay.error("向量化分块失败: "+a.message)}},V=async e=>{try{await _.deleteChunk(e),b.Ay.success("分块删除成功"),o.value&&await A(m.id),"chunks"===g.value&&await L()}catch(a){b.Ay.error("删除分块失败: "+a.message)}},B=()=>{s.value=!0},X=e=>{const a="text/markdown"===e.type||e.name.endsWith(".md");return a||b.Ay.error("只能上传 Markdown 文件!"),a},$=async({file:e,onSuccess:a,onError:t})=>{try{const n=await v.A.uploadFile(e);"success"===n.data.status?(b.Ay.success(n.data.message||"文件上传成功"),a(),C()):(b.Ay.error(n.data.message||"文件上传失败"),t())}catch(n){b.Ay.error("上传失败: "+n.message),t()}},z=async()=>{if(k.value){c.value=!0;try{const e=await v.A.importFromDirectory(k.value);"success"===e.data.status?(b.Ay.success(e.data.message||"导入成功"),s.value=!1,C()):b.Ay.error(e.data.message||"导入失败")}catch(e){b.Ay.error("导入知识库失败: "+e.message)}finally{c.value=!1}}else b.Ay.warning("请输入导入目录")};return(0,n.sV)((()=>{C()})),{loading:e,chunksLoading:a,knowledgeList:t,chunksList:l,knowledgeChunks:i,columns:w,chunkColumns:f,contentModalVisible:d,chunksModalVisible:o,importModalVisible:s,editChunkModalVisible:u,importLoading:c,saveChunkLoading:r,importDirectory:k,currentKnowledge:m,editingChunk:p,activeTab:g,selectedKnowledgeBase:h,refreshKnowledgeBases:x,viewContent:F,viewChunks:K,loadKnowledgeChunks:A,loadChunks:L,indexKnowledge:W,deleteKnowledge:R,editChunk:I,saveChunk:M,vectorizeChunk:U,deleteChunk:V,importKnowledge:B,beforeUpload:X,customUploadRequest:$,submitImport:z}}};var f=t(4093);const C=(0,f.A)(w,[["render",g],["__scopeId","data-v-f7c93668"]]),x=C}}]);
//# sourceMappingURL=413.js.map