"use strict";(self["webpackChunkdesign_helper_frontend"]=self["webpackChunkdesign_helper_frontend"]||[]).push([[451],{451:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var n=a(6254),o=a(8627);const l={class:"knowledge-base"},d={class:"knowledge-content-preview"},i={class:"ant-upload-drag-icon"};function s(e,t,a,s,r,c){const u=(0,n.g2)("a-button"),g=(0,n.g2)("a-page-header"),p=(0,n.g2)("a-popconfirm"),m=(0,n.g2)("a-space"),k=(0,n.g2)("a-table"),y=(0,n.g2)("a-modal"),b=(0,n.g2)("a-icon"),w=(0,n.g2)("a-upload-dragger"),f=(0,n.g2)("a-form-item"),v=(0,n.g2)("a-divider"),_=(0,n.g2)("a-input"),h=(0,n.g2)("a-form"),A=(0,n.g2)("a-card");return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.bF)(g,{title:"知识库管理","sub-title":"管理系统的知识库文档"},{extra:(0,n.k6)((()=>[(0,n.bF)(u,{type:"primary",onClick:s.importKnowledge},{default:(0,n.k6)((()=>t[3]||(t[3]=[(0,n.eW)("导入知识")]))),_:1},8,["onClick"])])),_:1}),(0,n.bF)(A,{class:"knowledge-content"},{default:(0,n.k6)((()=>[(0,n.bF)(k,{columns:s.columns,"data-source":s.knowledgeList,loading:s.loading,"row-key":"id"},{bodyCell:(0,n.k6)((({column:e,record:a})=>["actions"===e.key?((0,n.uX)(),(0,n.Wv)(m,{key:0},{default:(0,n.k6)((()=>[(0,n.bF)(u,{type:"link",onClick:e=>s.viewContent(a)},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("查看内容")]))),_:2},1032,["onClick"]),(0,n.bF)(u,{type:"link",onClick:e=>s.indexKnowledge(a.id),disabled:a.is_indexed},{default:(0,n.k6)((()=>[(0,n.eW)((0,o.v_)(a.is_indexed?"已向量化":"向量化"),1)])),_:2},1032,["onClick","disabled"]),(0,n.bF)(p,{title:"确定要删除此知识库?",onConfirm:e=>s.deleteKnowledge(a.id),"ok-text":"确定","cancel-text":"取消"},{default:(0,n.k6)((()=>[(0,n.bF)(u,{type:"link",danger:""},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source","loading"]),(0,n.bF)(y,{visible:s.contentModalVisible,"onUpdate:visible":t[0]||(t[0]=e=>s.contentModalVisible=e),title:s.currentKnowledge.name,width:"800px",footer:null},{default:(0,n.k6)((()=>[(0,n.Lk)("div",d,[(0,n.Lk)("pre",null,(0,o.v_)(s.currentKnowledge.content),1)])])),_:1},8,["visible","title"]),(0,n.bF)(y,{visible:s.importModalVisible,"onUpdate:visible":t[2]||(t[2]=e=>s.importModalVisible=e),title:"导入知识库",onOk:s.submitImport,confirmLoading:s.importLoading},{default:(0,n.k6)((()=>[(0,n.bF)(h,{layout:"vertical"},{default:(0,n.k6)((()=>[(0,n.bF)(f,{label:"从文件导入"},{default:(0,n.k6)((()=>[(0,n.bF)(w,{name:"file",multiple:!1,"before-upload":s.beforeUpload,"custom-request":s.customUploadRequest},{default:(0,n.k6)((()=>[(0,n.Lk)("p",i,[(0,n.bF)(b,{type:"inbox"})]),t[6]||(t[6]=(0,n.Lk)("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域上传",-1)),t[7]||(t[7]=(0,n.Lk)("p",{class:"ant-upload-hint"},"支持上传 Markdown 文件",-1))])),_:1},8,["before-upload","custom-request"])])),_:1}),(0,n.bF)(v,null,{default:(0,n.k6)((()=>t[8]||(t[8]=[(0,n.eW)("或者")]))),_:1}),(0,n.bF)(f,{label:"从目录导入"},{default:(0,n.k6)((()=>[(0,n.bF)(_,{value:s.importDirectory,"onUpdate:value":t[1]||(t[1]=e=>s.importDirectory=e),placeholder:"请输入知识库文件所在目录的绝对路径"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","onOk","confirmLoading"])])),_:1})])}var r=a(5598),c=a(3163),u=a(6327);const g={name:"KnowledgeBase",setup(){const e=(0,r.KR)(!1),t=(0,r.KR)([]),a=(0,r.KR)(!1),o=(0,r.KR)(!1),l=(0,r.KR)(!1),d=(0,r.KR)(""),i=(0,r.Kh)({id:null,name:"",content:""}),s=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"知识库名称",dataIndex:"name",key:"name",width:200},{title:"描述",dataIndex:"description",key:"description",width:300},{title:"文件路径",dataIndex:"file_path",key:"file_path",width:300},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",width:180},{title:"操作",key:"actions",width:200}],g=async()=>{e.value=!0;try{const e=await u.A.getKnowledgeBases();t.value=e.data||[]}catch(a){c.Ay.error("加载知识库列表失败: "+a.message)}finally{e.value=!1}},p=async e=>{try{const t=await u.A.getKnowledgeBase(e.id),n=t.data;i.id=n.id,i.name=n.name,i.content=n.content,a.value=!0}catch(t){c.Ay.error("获取知识库内容失败: "+t.message)}},m=async e=>{try{const t=await u.A.indexKnowledgeBase(e);"success"===t.data.status?(c.Ay.success(t.data.message||"知识库向量化成功"),g()):c.Ay.error(t.data.message||"知识库向量化失败")}catch(t){c.Ay.error("向量化知识库失败: "+t.message)}},k=async e=>{try{await u.A.deleteKnowledgeBase(e),c.Ay.success("知识库删除成功"),g()}catch(t){c.Ay.error("删除知识库失败: "+t.message)}},y=()=>{o.value=!0},b=e=>{const t="text/markdown"===e.type||e.name.endsWith(".md");return t||c.Ay.error("只能上传 Markdown 文件!"),t},w=async({file:e,onSuccess:t,onError:a})=>{try{const n=await u.A.uploadFile(e);"success"===n.data.status?(c.Ay.success(n.data.message||"文件上传成功"),t(),g()):(c.Ay.error(n.data.message||"文件上传失败"),a())}catch(n){c.Ay.error("上传失败: "+n.message),a()}},f=async()=>{if(d.value){l.value=!0;try{const e=await u.A.importFromDirectory(d.value);"success"===e.data.status?(c.Ay.success(e.data.message||"导入成功"),o.value=!1,g()):c.Ay.error(e.data.message||"导入失败")}catch(e){c.Ay.error("导入知识库失败: "+e.message)}finally{l.value=!1}}else c.Ay.warning("请输入导入目录")};return(0,n.sV)((()=>{g()})),{loading:e,knowledgeList:t,columns:s,contentModalVisible:a,importModalVisible:o,importLoading:l,importDirectory:d,currentKnowledge:i,loadKnowledgeList:g,viewContent:p,indexKnowledge:m,deleteKnowledge:k,importKnowledge:y,beforeUpload:b,customUploadRequest:w,submitImport:f}}};var p=a(4093);const m=(0,p.A)(g,[["render",s],["__scopeId","data-v-dfc9256a"]]),k=m}}]);
//# sourceMappingURL=451.js.map