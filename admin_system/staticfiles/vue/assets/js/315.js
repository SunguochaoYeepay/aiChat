"use strict";(self["webpackChunkdesign_helper_frontend"]=self["webpackChunkdesign_helper_frontend"]||[]).push([[315],{4315:(e,a,t)=>{t.r(a),t.d(a,{default:()=>f});var i=t(6254),r=t(8627);const s={class:"service-manager"},n={class:"page-title"},c={class:"action-buttons"};function l(e,a,t,l,d,o){const u=(0,i.g2)("a-button"),v=(0,i.g2)("a-tag"),m=(0,i.g2)("a-popconfirm"),p=(0,i.g2)("a-space"),g=(0,i.g2)("a-table"),y=(0,i.g2)("a-card"),k=(0,i.g2)("a-input"),f=(0,i.g2)("a-form-item"),S=(0,i.g2)("a-textarea"),b=(0,i.g2)("a-form"),h=(0,i.g2)("a-modal");return(0,i.uX)(),(0,i.CE)("div",s,[(0,i.Lk)("div",n,[a[6]||(a[6]=(0,i.Lk)("h2",null,"服务管理",-1)),a[7]||(a[7]=(0,i.Lk)("p",{class:"sub-title"},"管理系统服务",-1)),(0,i.Lk)("div",c,[(0,i.bF)(u,{type:"primary",onClick:l.refreshServices,style:{"margin-right":"8px"}},{default:(0,i.k6)((()=>a[4]||(a[4]=[(0,i.eW)("刷新")]))),_:1},8,["onClick"]),(0,i.bF)(u,{type:"primary",onClick:l.showAddModal},{default:(0,i.k6)((()=>a[5]||(a[5]=[(0,i.eW)("添加服务")]))),_:1},8,["onClick"])])]),(0,i.bF)(y,null,{default:(0,i.k6)((()=>[(0,i.bF)(g,{columns:l.columns,"data-source":l.services,loading:l.loading,"row-key":"id"},{bodyCell:(0,i.k6)((({column:e,record:t})=>["status"===e.key?((0,i.uX)(),(0,i.Wv)(v,{key:0,color:"running"===t.status?"green":"red"},{default:(0,i.k6)((()=>[(0,i.eW)((0,r.v_)(t.status_display),1)])),_:2},1032,["color"])):(0,i.Q3)("",!0),"actions"===e.key?((0,i.uX)(),(0,i.Wv)(p,{key:1},{default:(0,i.k6)((()=>["running"!==t.status?((0,i.uX)(),(0,i.Wv)(u,{key:0,type:"primary",size:"small",onClick:e=>l.startService(t),loading:l.actionLoading[t.id]},{default:(0,i.k6)((()=>a[8]||(a[8]=[(0,i.eW)(" 启动 ")]))),_:2},1032,["onClick","loading"])):((0,i.uX)(),(0,i.Wv)(u,{key:1,danger:"",size:"small",onClick:e=>l.stopService(t),loading:l.actionLoading[t.id]},{default:(0,i.k6)((()=>a[9]||(a[9]=[(0,i.eW)(" 停止 ")]))),_:2},1032,["onClick","loading"])),(0,i.bF)(u,{type:"link",size:"small",onClick:e=>l.editService(t)},{default:(0,i.k6)((()=>a[10]||(a[10]=[(0,i.eW)("编辑")]))),_:2},1032,["onClick"]),(0,i.bF)(m,{title:"确定要删除此服务吗?",onConfirm:e=>l.deleteService(t.id),"ok-text":"确定","cancel-text":"取消"},{default:(0,i.k6)((()=>[(0,i.bF)(u,{type:"link",danger:"",size:"small"},{default:(0,i.k6)((()=>a[11]||(a[11]=[(0,i.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,i.Q3)("",!0)])),_:1},8,["columns","data-source","loading"])])),_:1}),(0,i.bF)(h,{visible:l.modalVisible,"onUpdate:visible":a[3]||(a[3]=e=>l.modalVisible=e),title:l.isEditing?"编辑服务":"添加服务",onOk:l.saveService,confirmLoading:l.submitLoading},{default:(0,i.k6)((()=>[(0,i.bF)(b,{layout:"vertical"},{default:(0,i.k6)((()=>[(0,i.bF)(f,{label:"服务名称"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{value:l.currentService.name,"onUpdate:value":a[0]||(a[0]=e=>l.currentService.name=e),placeholder:"输入服务名称"},null,8,["value"])])),_:1}),(0,i.bF)(f,{label:"描述"},{default:(0,i.k6)((()=>[(0,i.bF)(S,{value:l.currentService.description,"onUpdate:value":a[1]||(a[1]=e=>l.currentService.description=e),placeholder:"输入服务描述",rows:3},null,8,["value"])])),_:1}),(0,i.bF)(f,{label:"启动命令"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{value:l.currentService.command,"onUpdate:value":a[2]||(a[2]=e=>l.currentService.command=e),placeholder:"输入服务启动命令"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["visible","title","onOk","confirmLoading"])])}var d=t(5598),o=t(3163),u=t(6357);const v="/api/v1/services/",m={getServices(){return u.A.get(v)},getService(e){return u.A.get(`${v}${e}/`)},createService(e){return u.A.post(v,e)},updateService(e,a){return u.A.put(`${v}${e}/`,a)},deleteService(e){return u.A.delete(`${v}${e}/`)},startService(e){return u.A.post(`${v}${e}/start/`)},stopService(e){return u.A.post(`${v}${e}/stop/`)},refreshServiceStatus(){return u.A.get(`${v}refresh_status/`)}},p=m,g={name:"ServiceManager",setup(){const e=(0,d.KR)([]),a=(0,d.KR)(!1),t=(0,d.KR)(!1),r=(0,d.KR)(!1),s=(0,d.KR)(!1),n=(0,d.Kh)({}),c=(0,d.Kh)({id:null,name:"",description:"",command:"",status:"stopped"});let l=null;const u=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"服务名称",dataIndex:"name",key:"name",width:200},{title:"描述",dataIndex:"description",key:"description"},{title:"状态",dataIndex:"status",key:"status",width:120},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",width:180},{title:"操作",key:"actions",width:200}],v=async()=>{a.value=!0;try{const a=await p.getServices();e.value=a.data}catch(t){o.Ay.error("加载服务列表失败: "+t.message)}finally{a.value=!1}},m=async()=>{try{const a=await p.refreshServiceStatus();e.value=a.data,o.Ay.success("服务状态已刷新")}catch(a){o.Ay.error("刷新服务状态失败: "+a.message)}},g=()=>{y(),l=setInterval((async()=>{try{const a=await p.refreshServiceStatus();e.value=a.data}catch(a){console.error("刷新服务状态失败:",a)}}),5e3)},y=()=>{l&&(clearInterval(l),l=null)},k=async e=>{n[e.id]=!0;try{const a=await p.startService(e.id);o.Ay.success(a.data.message||"服务已启动"),m()}catch(a){o.Ay.error("启动服务失败: "+(a.response?.data?.message||a.message))}finally{n[e.id]=!1}},f=async e=>{n[e.id]=!0;try{const a=await p.stopService(e.id);o.Ay.success(a.data.message||"服务已停止"),m()}catch(a){o.Ay.error("停止服务失败: "+(a.response?.data?.message||a.message))}finally{n[e.id]=!1}},S=()=>{r.value=!1,Object.assign(c,{id:null,name:"",description:"",command:"",status:"stopped"}),t.value=!0},b=e=>{r.value=!0,Object.assign(c,e),t.value=!0},h=async()=>{if(c.name&&c.command){s.value=!0;try{r.value?(await p.updateService(c.id,{name:c.name,description:c.description,command:c.command}),o.Ay.success("服务更新成功")):(await p.createService({name:c.name,description:c.description,command:c.command,status:"stopped"}),o.Ay.success("服务添加成功")),t.value=!1,v()}catch(e){o.Ay.error((r.value?"更新":"添加")+"服务失败: "+e.message)}finally{s.value=!1}}else o.Ay.error("服务名称和启动命令不能为空")},_=async e=>{try{await p.deleteService(e),o.Ay.success("服务删除成功"),v()}catch(a){o.Ay.error("删除服务失败: "+a.message)}};return(0,i.sV)((()=>{v(),g()})),(0,i.hi)((()=>{y()})),{services:e,loading:a,columns:u,modalVisible:t,isEditing:r,currentService:c,submitLoading:s,actionLoading:n,refreshServices:m,startService:k,stopService:f,showAddModal:S,editService:b,saveService:h,deleteService:_}}};var y=t(4093);const k=(0,y.A)(g,[["render",l],["__scopeId","data-v-7fb2d2cb"]]),f=k}}]);
//# sourceMappingURL=315.js.map