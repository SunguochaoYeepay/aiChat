"use strict";(self["webpackChunkdesign_helper_frontend"]=self["webpackChunkdesign_helper_frontend"]||[]).push([[120],{5120:(e,a,r)=>{r.r(a),r.d(a,{default:()=>v});var l=r(6254),s=r(8627);const t={class:"user-manager-container"};function o(e,a,r,o,i,n){const d=(0,l.g2)("plus-outlined"),u=(0,l.g2)("a-button"),c=(0,l.g2)("a-tag"),m=(0,l.g2)("a-popconfirm"),f=(0,l.g2)("a-space"),v=(0,l.g2)("a-table"),p=(0,l.g2)("a-input"),b=(0,l.g2)("a-form-item"),_=(0,l.g2)("a-input-password"),k=(0,l.g2)("a-checkbox"),g=(0,l.g2)("a-form"),F=(0,l.g2)("a-modal"),y=(0,l.g2)("a-card");return(0,l.uX)(),(0,l.CE)("div",t,[(0,l.bF)(y,{title:"用户管理",bordered:!1},{extra:(0,l.k6)((()=>[(0,l.bF)(u,{type:"primary",onClick:e.showCreateModal},{icon:(0,l.k6)((()=>[(0,l.bF)(d)])),default:(0,l.k6)((()=>[a[11]||(a[11]=(0,l.eW)(" 创建用户 "))])),_:1},8,["onClick"])])),default:(0,l.k6)((()=>[(0,l.bF)(v,{columns:e.columns,"data-source":e.users,loading:e.loading,pagination:{pageSize:10},rowKey:"id"},{bodyCell:(0,l.k6)((({column:r,record:t})=>["is_active"===r.dataIndex?((0,l.uX)(),(0,l.Wv)(c,{key:0,color:t.is_active?"green":"red"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(t.is_active?"激活":"禁用"),1)])),_:2},1032,["color"])):"is_staff"===r.dataIndex?((0,l.uX)(),(0,l.Wv)(c,{key:1,color:t.is_staff?"blue":"default"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(t.is_staff?"管理员":"普通用户"),1)])),_:2},1032,["color"])):"action"===r.dataIndex?((0,l.uX)(),(0,l.Wv)(f,{key:2},{default:(0,l.k6)((()=>[(0,l.bF)(u,{type:"link",onClick:a=>e.showEditModal(t)},{default:(0,l.k6)((()=>a[12]||(a[12]=[(0,l.eW)("编辑")]))),_:2},1032,["onClick"]),(0,l.bF)(m,{title:"确定要删除这个用户吗？","ok-text":"确定","cancel-text":"取消",onConfirm:a=>e.deleteUser(t)},{default:(0,l.k6)((()=>[(0,l.bF)(u,{type:"link",danger:""},{default:(0,l.k6)((()=>a[13]||(a[13]=[(0,l.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,l.Q3)("",!0)])),_:1},8,["columns","data-source","loading"]),(0,l.bF)(F,{visible:e.createModalVisible,"onUpdate:visible":a[4]||(a[4]=a=>e.createModalVisible=a),title:"创建用户",onOk:e.handleCreateUser,confirmLoading:e.modalLoading},{default:(0,l.k6)((()=>[(0,l.bF)(g,{model:e.userForm,rules:e.rules,ref:"createFormRef",layout:"vertical"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{label:"用户名",name:"username"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{value:e.userForm.username,"onUpdate:value":a[0]||(a[0]=a=>e.userForm.username=a),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),(0,l.bF)(b,{label:"邮箱",name:"email"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{value:e.userForm.email,"onUpdate:value":a[1]||(a[1]=a=>e.userForm.email=a),placeholder:"请输入邮箱"},null,8,["value"])])),_:1}),(0,l.bF)(b,{label:"密码",name:"password"},{default:(0,l.k6)((()=>[(0,l.bF)(_,{value:e.userForm.password,"onUpdate:value":a[2]||(a[2]=a=>e.userForm.password=a),placeholder:"请输入密码"},null,8,["value"])])),_:1}),(0,l.bF)(b,{name:"is_staff"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{checked:e.userForm.is_staff,"onUpdate:checked":a[3]||(a[3]=a=>e.userForm.is_staff=a)},{default:(0,l.k6)((()=>a[14]||(a[14]=[(0,l.eW)("设为管理员")]))),_:1},8,["checked"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onOk","confirmLoading"]),(0,l.bF)(F,{visible:e.editModalVisible,"onUpdate:visible":a[10]||(a[10]=a=>e.editModalVisible=a),title:"编辑用户",onOk:e.handleUpdateUser,confirmLoading:e.modalLoading},{default:(0,l.k6)((()=>[(0,l.bF)(g,{model:e.userForm,rules:e.editRules,ref:"editFormRef",layout:"vertical"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{label:"用户名",name:"username"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{value:e.userForm.username,"onUpdate:value":a[5]||(a[5]=a=>e.userForm.username=a),placeholder:"请输入用户名"},null,8,["value"])])),_:1}),(0,l.bF)(b,{label:"邮箱",name:"email"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{value:e.userForm.email,"onUpdate:value":a[6]||(a[6]=a=>e.userForm.email=a),placeholder:"请输入邮箱"},null,8,["value"])])),_:1}),(0,l.bF)(b,{label:"密码",name:"password",extra:"如不修改密码请留空"},{default:(0,l.k6)((()=>[(0,l.bF)(_,{value:e.userForm.password,"onUpdate:value":a[7]||(a[7]=a=>e.userForm.password=a),placeholder:"请输入新密码"},null,8,["value"])])),_:1}),(0,l.bF)(b,{name:"is_active"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{checked:e.userForm.is_active,"onUpdate:checked":a[8]||(a[8]=a=>e.userForm.is_active=a)},{default:(0,l.k6)((()=>a[15]||(a[15]=[(0,l.eW)("启用账户")]))),_:1},8,["checked"])])),_:1}),(0,l.bF)(b,{name:"is_staff"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{checked:e.userForm.is_staff,"onUpdate:checked":a[9]||(a[9]=a=>e.userForm.is_staff=a)},{default:(0,l.k6)((()=>a[16]||(a[16]=[(0,l.eW)("设为管理员")]))),_:1},8,["checked"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onOk","confirmLoading"])])),_:1})])}var i=r(5598),n=r(3163),d=r(5870),u=r(3802);const c=(0,l.pM)({name:"UserManager",components:{PlusOutlined:d.A},setup(){const e=(0,i.KR)([]),a=(0,i.KR)(!1),r=(0,i.KR)(!1),s=(0,i.KR)(!1),t=(0,i.KR)(!1),o=(0,i.KR)(null),d=(0,i.KR)(null),c=(0,i.KR)(null),m=[{title:"ID",dataIndex:"id",key:"id"},{title:"用户名",dataIndex:"username",key:"username"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"状态",dataIndex:"is_active",key:"is_active"},{title:"角色",dataIndex:"is_staff",key:"is_staff"},{title:"创建时间",dataIndex:"date_joined",key:"date_joined"},{title:"最后登录",dataIndex:"last_login",key:"last_login"},{title:"操作",dataIndex:"action",key:"action"}],f=(0,i.Kh)({username:"",email:"",password:"",is_active:!0,is_staff:!1}),v={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},p={username:[{required:!0,message:"请输入用户名",trigger:"blur"}]},b=async()=>{a.value=!0;try{const a=await(0,u.aU)();e.value=a.data.users}catch(r){console.error("获取用户列表失败:",r),n.Ay.error("获取用户列表失败")}finally{a.value=!1}},_=()=>{g(),r.value=!0},k=e=>{g(),o.value=e.id,f.username=e.username,f.email=e.email,f.password="",f.is_active=e.is_active,f.is_staff=e.is_staff,s.value=!0},g=()=>{f.username="",f.email="",f.password="",f.is_active=!0,f.is_staff=!1,o.value=null},F=async()=>{try{await d.value.validate(),t.value=!0,await(0,u.kg)({username:f.username,email:f.email,password:f.password,is_staff:f.is_staff}),n.Ay.success("创建用户成功"),r.value=!1,b()}catch(e){e.response&&e.response.data?n.Ay.error(e.response.data.error||"创建用户失败"):e.message?console.error("表单验证失败",e):n.Ay.error("创建用户失败")}finally{t.value=!1}},y=async()=>{try{await c.value.validate(),t.value=!0;const e={username:f.username,email:f.email,is_active:f.is_active,is_staff:f.is_staff};f.password&&(e.password=f.password),await(0,u.TK)(o.value,e),n.Ay.success("更新用户成功"),s.value=!1,b()}catch(e){e.response&&e.response.data?n.Ay.error(e.response.data.error||"更新用户失败"):e.message?console.error("表单验证失败",e):n.Ay.error("更新用户失败")}finally{t.value=!1}},h=async e=>{a.value=!0;try{await(0,u.hG)(e.id),n.Ay.success(`用户 ${e.username} 已删除`),b()}catch(r){r.response&&r.response.data?n.Ay.error(r.response.data.error||"删除用户失败"):n.Ay.error("删除用户失败")}finally{a.value=!1}};return(0,l.sV)((()=>{b()})),{users:e,loading:a,columns:m,userForm:f,rules:v,editRules:p,createModalVisible:r,editModalVisible:s,modalLoading:t,createFormRef:d,editFormRef:c,showCreateModal:_,showEditModal:k,handleCreateUser:F,handleUpdateUser:y,deleteUser:h}}});var m=r(4093);const f=(0,m.A)(c,[["render",o],["__scopeId","data-v-63cf5e56"]]),v=f},5870:(e,a,r)=>{r.d(a,{A:()=>u});var l=r(6254),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"};const t=s;var o=r(5419);function i(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),l.forEach((function(a){n(e,a,r[a])}))}return e}function n(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}var d=function(e,a){var r=i({},e,a.attrs);return(0,l.bF)(o.A,i({},r,{icon:t}),null)};d.displayName="PlusOutlined",d.inheritAttrs=!1;const u=d}}]);
//# sourceMappingURL=120.js.map