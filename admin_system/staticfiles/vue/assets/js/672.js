"use strict";(self["webpackChunkdesign_helper_frontend"]=self["webpackChunkdesign_helper_frontend"]||[]).push([[672],{3672:(e,a,i)=>{i.r(a),i.d(a,{default:()=>m});var t=i(6254),l=i(8627);const n={class:"model-config-manager"},o={class:"page-title"},d={class:"action-buttons"};function c(e,a,i,c,s,r){const u=(0,t.g2)("a-button"),g=(0,t.g2)("a-tag"),f=(0,t.g2)("a-popconfirm"),v=(0,t.g2)("a-space"),p=(0,t.g2)("a-table"),_=(0,t.g2)("a-card"),k=(0,t.g2)("a-input"),m=(0,t.g2)("a-form-item"),b=(0,t.g2)("a-textarea"),y=(0,t.g2)("a-select-option"),C=(0,t.g2)("a-select"),h=(0,t.g2)("a-col"),F=(0,t.g2)("a-input-number"),w=(0,t.g2)("a-row"),A=(0,t.g2)("a-switch"),M=(0,t.g2)("a-form"),W=(0,t.g2)("a-modal");return(0,t.uX)(),(0,t.CE)("div",n,[(0,t.Lk)("div",o,[a[10]||(a[10]=(0,t.Lk)("h2",null,"模型配置管理",-1)),a[11]||(a[11]=(0,t.Lk)("p",{class:"sub-title"},"管理AI模型配置",-1)),(0,t.Lk)("div",d,[(0,t.bF)(u,{type:"primary",onClick:c.loadConfigs,style:{"margin-right":"8px"}},{default:(0,t.k6)((()=>a[8]||(a[8]=[(0,t.eW)("刷新")]))),_:1},8,["onClick"]),(0,t.bF)(u,{type:"primary",onClick:c.showAddModal},{default:(0,t.k6)((()=>a[9]||(a[9]=[(0,t.eW)("添加配置")]))),_:1},8,["onClick"])])]),(0,t.bF)(_,null,{default:(0,t.k6)((()=>[(0,t.bF)(p,{columns:c.columns,"data-source":c.configs,loading:c.loading,"row-key":"id"},{bodyCell:(0,t.k6)((({column:e,record:i})=>["is_active"===e.key?((0,t.uX)(),(0,t.Wv)(g,{key:0,color:i.is_active?"green":"default"},{default:(0,t.k6)((()=>[(0,t.eW)((0,l.v_)(i.is_active?"已激活":"未激活"),1)])),_:2},1032,["color"])):(0,t.Q3)("",!0),"device"===e.key?((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.eW)((0,l.v_)(i.device_display),1)],64)):(0,t.Q3)("",!0),"precision"===e.key?((0,t.uX)(),(0,t.CE)(t.FK,{key:2},[(0,t.eW)((0,l.v_)(i.precision_display),1)],64)):(0,t.Q3)("",!0),"actions"===e.key?((0,t.uX)(),(0,t.Wv)(v,{key:3},{default:(0,t.k6)((()=>[i.is_active?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(u,{key:0,type:"primary",size:"small",onClick:e=>c.activateConfig(i),loading:c.actionLoading[i.id]},{default:(0,t.k6)((()=>a[12]||(a[12]=[(0,t.eW)(" 激活 ")]))),_:2},1032,["onClick","loading"])),i.is_active?((0,t.uX)(),(0,t.Wv)(u,{key:1,type:"primary",size:"small",onClick:e=>c.reloadModel(i),loading:c.actionLoading[i.id]},{default:(0,t.k6)((()=>a[13]||(a[13]=[(0,t.eW)(" 重载模型 ")]))),_:2},1032,["onClick","loading"])):(0,t.Q3)("",!0),(0,t.bF)(u,{type:"link",size:"small",onClick:e=>c.editConfig(i)},{default:(0,t.k6)((()=>a[14]||(a[14]=[(0,t.eW)("编辑")]))),_:2},1032,["onClick"]),i.is_active?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(f,{key:2,title:"确定要删除此配置吗?",onConfirm:e=>c.deleteConfig(i.id),"ok-text":"确定","cancel-text":"取消"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{type:"link",danger:"",size:"small"},{default:(0,t.k6)((()=>a[15]||(a[15]=[(0,t.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"]))])),_:2},1024)):(0,t.Q3)("",!0)])),_:1},8,["columns","data-source","loading"])])),_:1}),(0,t.bF)(W,{visible:c.modalVisible,"onUpdate:visible":a[7]||(a[7]=e=>c.modalVisible=e),title:c.isEditing?"编辑模型配置":"添加模型配置",onOk:c.saveConfig,confirmLoading:c.submitLoading,width:"700px"},{default:(0,t.k6)((()=>[(0,t.bF)(M,{layout:"vertical"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{label:"模型名称"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{value:c.currentConfig.name,"onUpdate:value":a[0]||(a[0]=e=>c.currentConfig.name=e),placeholder:"输入模型配置名称"},null,8,["value"])])),_:1}),(0,t.bF)(m,{label:"模型路径"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{value:c.currentConfig.model_path,"onUpdate:value":a[1]||(a[1]=e=>c.currentConfig.model_path=e),placeholder:"输入模型文件/目录路径"},null,8,["value"])])),_:1}),(0,t.bF)(m,{label:"描述"},{default:(0,t.k6)((()=>[(0,t.bF)(b,{value:c.currentConfig.description,"onUpdate:value":a[2]||(a[2]=e=>c.currentConfig.description=e),placeholder:"输入模型配置描述",rows:2},null,8,["value"])])),_:1}),(0,t.bF)(w,{gutter:16},{default:(0,t.k6)((()=>[(0,t.bF)(h,{span:8},{default:(0,t.k6)((()=>[(0,t.bF)(m,{label:"运行设备"},{default:(0,t.k6)((()=>[(0,t.bF)(C,{value:c.currentConfig.device,"onUpdate:value":a[3]||(a[3]=e=>c.currentConfig.device=e)},{default:(0,t.k6)((()=>[(0,t.bF)(y,{value:"cuda"},{default:(0,t.k6)((()=>a[16]||(a[16]=[(0,t.eW)("GPU (CUDA)")]))),_:1}),(0,t.bF)(y,{value:"cpu"},{default:(0,t.k6)((()=>a[17]||(a[17]=[(0,t.eW)("CPU")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),(0,t.bF)(h,{span:8},{default:(0,t.k6)((()=>[(0,t.bF)(m,{label:"批处理大小"},{default:(0,t.k6)((()=>[(0,t.bF)(F,{value:c.currentConfig.batch_size,"onUpdate:value":a[4]||(a[4]=e=>c.currentConfig.batch_size=e),min:1,max:16},null,8,["value"])])),_:1})])),_:1}),(0,t.bF)(h,{span:8},{default:(0,t.k6)((()=>[(0,t.bF)(m,{label:"精度"},{default:(0,t.k6)((()=>[(0,t.bF)(C,{value:c.currentConfig.precision,"onUpdate:value":a[5]||(a[5]=e=>c.currentConfig.precision=e)},{default:(0,t.k6)((()=>[(0,t.bF)(y,{value:"float16"},{default:(0,t.k6)((()=>a[18]||(a[18]=[(0,t.eW)("半精度 (float16)")]))),_:1}),(0,t.bF)(y,{value:"float32"},{default:(0,t.k6)((()=>a[19]||(a[19]=[(0,t.eW)("全精度 (float32)")]))),_:1})])),_:1},8,["value"])])),_:1})])),_:1})])),_:1}),(0,t.bF)(m,{label:"激活状态"},{default:(0,t.k6)((()=>[(0,t.bF)(A,{checked:c.currentConfig.is_active,"onUpdate:checked":a[6]||(a[6]=e=>c.currentConfig.is_active=e)},null,8,["checked"]),a[20]||(a[20]=(0,t.Lk)("span",{class:"form-help-text"},"如果激活，该配置将被用于模型加载",-1))])),_:1})])),_:1})])),_:1},8,["visible","title","onOk","confirmLoading"])])}var s=i(5598),r=i(3163),u=i(6357);const g="/api/v1/models/",f={getModelConfigs(){return u.A.get(g)},getModelConfig(e){return u.A.get(`${g}${e}/`)},createModelConfig(e){return u.A.post(g,e)},updateModelConfig(e,a){return u.A.put(`${g}${e}/`,a)},deleteModelConfig(e){return u.A.delete(`${g}${e}/`)},activateModelConfig(e){return u.A.post(`${g}${e}/activate/`)},reloadModel(e){return u.A.post(`${g}${e}/reload_model/`)}},v=f,p={name:"ModelConfigManager",setup(){const e=(0,s.KR)([]),a=(0,s.KR)(!1),i=(0,s.KR)(!1),l=(0,s.KR)(!1),n=(0,s.KR)(!1),o=(0,s.Kh)({}),d=(0,s.Kh)({id:null,name:"",model_path:"",device:"cuda",is_active:!1,batch_size:1,precision:"float16",description:""}),c=[{title:"ID",dataIndex:"id",key:"id",width:70},{title:"名称",dataIndex:"name",key:"name",width:150},{title:"模型路径",dataIndex:"model_path",key:"model_path",width:250,ellipsis:!0},{title:"设备",dataIndex:"device",key:"device",width:100},{title:"批处理大小",dataIndex:"batch_size",key:"batch_size",width:100},{title:"精度",dataIndex:"precision",key:"precision",width:120},{title:"状态",dataIndex:"is_active",key:"is_active",width:100},{title:"操作",key:"actions",width:220}],u=async()=>{a.value=!0;try{const a=await v.getModelConfigs();e.value=a.data}catch(i){r.Ay.error("加载模型配置失败: "+i.message)}finally{a.value=!1}},g=()=>{l.value=!1,Object.assign(d,{id:null,name:"",model_path:"",device:"cuda",is_active:!1,batch_size:1,precision:"float16",description:""}),i.value=!0},f=e=>{l.value=!0,Object.assign(d,e),i.value=!0},p=async()=>{if(d.name&&d.model_path){n.value=!0;try{l.value?(await v.updateModelConfig(d.id,{name:d.name,model_path:d.model_path,device:d.device,is_active:d.is_active,batch_size:d.batch_size,precision:d.precision,description:d.description}),r.Ay.success("模型配置更新成功")):(await v.createModelConfig({name:d.name,model_path:d.model_path,device:d.device,is_active:d.is_active,batch_size:d.batch_size,precision:d.precision,description:d.description}),r.Ay.success("模型配置添加成功")),i.value=!1,u()}catch(e){r.Ay.error((l.value?"更新":"添加")+"模型配置失败: "+e.message)}finally{n.value=!1}}else r.Ay.error("模型名称和路径不能为空")},_=async e=>{o[e.id]=!0;try{const a=await v.activateModelConfig(e.id);r.Ay.success(a.data.message||"模型配置已激活"),u()}catch(a){r.Ay.error("激活模型配置失败: "+(a.response?.data?.message||a.message))}finally{o[e.id]=!1}},k=async e=>{o[e.id]=!0;try{const a=await v.reloadModel(e.id);r.Ay.success(a.data.message||"模型已重新加载")}catch(a){r.Ay.error("重载模型失败: "+(a.response?.data?.message||a.message))}finally{o[e.id]=!1}},m=async e=>{try{await v.deleteModelConfig(e),r.Ay.success("模型配置删除成功"),u()}catch(a){r.Ay.error("删除模型配置失败: "+a.message)}};return(0,t.sV)((()=>{u()})),{configs:e,loading:a,columns:c,modalVisible:i,isEditing:l,currentConfig:d,submitLoading:n,actionLoading:o,loadConfigs:u,showAddModal:g,editConfig:f,saveConfig:p,activateConfig:_,reloadModel:k,deleteConfig:m}}};var _=i(4093);const k=(0,_.A)(p,[["render",c],["__scopeId","data-v-c0631222"]]),m=k}}]);
//# sourceMappingURL=672.js.map