"use strict";(self["webpackChunkdesign_helper_frontend"]=self["webpackChunkdesign_helper_frontend"]||[]).push([[232],{2232:(e,a,t)=>{t.r(a),t.d(a,{default:()=>g});var l=t(6254),i=t(8627);const r={class:"api-key-manager-container"},o={class:"key-display"},n={class:"key-actions"};function s(e,a,t,s,d,c){const p=(0,l.g2)("plus-outlined"),u=(0,l.g2)("a-button"),v=(0,l.g2)("a-tag"),y=(0,l.g2)("a-popconfirm"),m=(0,l.g2)("a-space"),_=(0,l.g2)("a-table"),b=(0,l.g2)("a-input"),k=(0,l.g2)("a-form-item"),f=(0,l.g2)("a-textarea"),A=(0,l.g2)("a-date-picker"),F=(0,l.g2)("a-input-number"),h=(0,l.g2)("a-form"),g=(0,l.g2)("a-modal"),w=(0,l.g2)("a-checkbox"),K=(0,l.g2)("a-input-password"),I=(0,l.g2)("a-card");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(I,{title:"API密钥管理",bordered:!1},{extra:(0,l.k6)((()=>[(0,l.bF)(u,{type:"primary",onClick:e.showCreateModal},{icon:(0,l.k6)((()=>[(0,l.bF)(p)])),default:(0,l.k6)((()=>[a[15]||(a[15]=(0,l.eW)(" 创建API密钥 "))])),_:1},8,["onClick"])])),default:(0,l.k6)((()=>[(0,l.bF)(_,{columns:e.columns,"data-source":e.apiKeys,loading:e.loading,pagination:{pageSize:10},rowKey:"id"},{bodyCell:(0,l.k6)((({column:t,record:r})=>["is_active"===t.dataIndex?((0,l.uX)(),(0,l.Wv)(v,{key:0,color:r.is_active?"green":"red"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(r.is_active?"激活":"禁用"),1)])),_:2},1032,["color"])):"action"===t.dataIndex?((0,l.uX)(),(0,l.Wv)(m,{key:1},{default:(0,l.k6)((()=>[(0,l.bF)(u,{type:"link",onClick:a=>e.copyApiKey(r)},{default:(0,l.k6)((()=>a[16]||(a[16]=[(0,l.eW)("复制")]))),_:2},1032,["onClick"]),(0,l.bF)(u,{type:"link",onClick:a=>e.showEditModal(r)},{default:(0,l.k6)((()=>a[17]||(a[17]=[(0,l.eW)("编辑")]))),_:2},1032,["onClick"]),(0,l.bF)(y,{title:"确定要删除这个API密钥吗？","ok-text":"确定","cancel-text":"取消",onConfirm:a=>e.deleteApiKey(r)},{default:(0,l.k6)((()=>[(0,l.bF)(u,{type:"link",danger:""},{default:(0,l.k6)((()=>a[18]||(a[18]=[(0,l.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)):(0,l.Q3)("",!0)])),_:1},8,["columns","data-source","loading"]),(0,l.bF)(g,{visible:e.createModalVisible,"onUpdate:visible":a[5]||(a[5]=a=>e.createModalVisible=a),title:"创建API密钥",onOk:e.handleCreateApiKey,confirmLoading:e.modalLoading},{default:(0,l.k6)((()=>[(0,l.bF)(h,{model:e.apiKeyForm,rules:e.rules,ref:"createFormRef",layout:"vertical"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{label:"名称",name:"name"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{value:e.apiKeyForm.name,"onUpdate:value":a[0]||(a[0]=a=>e.apiKeyForm.name=a),placeholder:"请输入API密钥名称"},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"描述",name:"description"},{default:(0,l.k6)((()=>[(0,l.bF)(f,{value:e.apiKeyForm.description,"onUpdate:value":a[1]||(a[1]=a=>e.apiKeyForm.description=a),placeholder:"请输入描述",rows:"4"},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"过期时间",name:"expires_at"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{value:e.apiKeyForm.expires_at,"onUpdate:value":a[2]||(a[2]=a=>e.apiKeyForm.expires_at=a),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择过期时间（可选）",style:{width:"100%"}},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"允许的IP地址",name:"allowed_ips"},{default:(0,l.k6)((()=>[(0,l.bF)(f,{value:e.apiKeyForm.allowed_ips,"onUpdate:value":a[3]||(a[3]=a=>e.apiKeyForm.allowed_ips=a),placeholder:"请输入允许的IP地址，多个IP用逗号分隔（可选）",rows:"2"},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"速率限制（每分钟请求数）",name:"rate_limit_override"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{value:e.apiKeyForm.rate_limit_override,"onUpdate:value":a[4]||(a[4]=a=>e.apiKeyForm.rate_limit_override=a),placeholder:"留空表示使用接口默认限制",style:{width:"100%"}},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onOk","confirmLoading"]),(0,l.bF)(g,{visible:e.editModalVisible,"onUpdate:visible":a[12]||(a[12]=a=>e.editModalVisible=a),title:"编辑API密钥",onOk:e.handleUpdateApiKey,confirmLoading:e.modalLoading},{default:(0,l.k6)((()=>[(0,l.bF)(h,{model:e.apiKeyForm,rules:e.rules,ref:"editFormRef",layout:"vertical"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{label:"名称",name:"name"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{value:e.apiKeyForm.name,"onUpdate:value":a[6]||(a[6]=a=>e.apiKeyForm.name=a),placeholder:"请输入API密钥名称"},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"描述",name:"description"},{default:(0,l.k6)((()=>[(0,l.bF)(f,{value:e.apiKeyForm.description,"onUpdate:value":a[7]||(a[7]=a=>e.apiKeyForm.description=a),placeholder:"请输入描述",rows:"4"},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"过期时间",name:"expires_at"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{value:e.apiKeyForm.expires_at,"onUpdate:value":a[8]||(a[8]=a=>e.apiKeyForm.expires_at=a),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择过期时间（可选）",style:{width:"100%"}},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"允许的IP地址",name:"allowed_ips"},{default:(0,l.k6)((()=>[(0,l.bF)(f,{value:e.apiKeyForm.allowed_ips,"onUpdate:value":a[9]||(a[9]=a=>e.apiKeyForm.allowed_ips=a),placeholder:"请输入允许的IP地址，多个IP用逗号分隔（可选）",rows:"2"},null,8,["value"])])),_:1}),(0,l.bF)(k,{label:"速率限制（每分钟请求数）",name:"rate_limit_override"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{value:e.apiKeyForm.rate_limit_override,"onUpdate:value":a[10]||(a[10]=a=>e.apiKeyForm.rate_limit_override=a),placeholder:"留空表示使用接口默认限制",style:{width:"100%"}},null,8,["value"])])),_:1}),(0,l.bF)(k,{name:"is_active"},{default:(0,l.k6)((()=>[(0,l.bF)(w,{checked:e.apiKeyForm.is_active,"onUpdate:checked":a[11]||(a[11]=a=>e.apiKeyForm.is_active=a)},{default:(0,l.k6)((()=>a[19]||(a[19]=[(0,l.eW)("激活")]))),_:1},8,["checked"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["visible","onOk","confirmLoading"]),(0,l.bF)(g,{visible:e.keyDisplayModalVisible,"onUpdate:visible":a[14]||(a[14]=a=>e.keyDisplayModalVisible=a),title:"API密钥创建成功",closable:!1,maskClosable:!1,footer:null},{default:(0,l.k6)((()=>[(0,l.Lk)("div",o,[a[21]||(a[21]=(0,l.Lk)("p",{class:"warning-text"},"⚠️ 请记下您的API密钥，此密钥只会显示一次！",-1)),(0,l.bF)(K,{value:e.newApiKey,"onUpdate:value":a[13]||(a[13]=a=>e.newApiKey=a),readonly:"",addonAfter:e.copyAddon},null,8,["value","addonAfter"]),(0,l.Lk)("div",n,[(0,l.bF)(u,{type:"primary",onClick:e.handleApiKeyCopied},{default:(0,l.k6)((()=>a[20]||(a[20]=[(0,l.eW)(" 我已复制密钥 ")]))),_:1},8,["onClick"])])])])),_:1},8,["visible"])])),_:1})])}var d=t(5598),c=t(3163),p=t(5870),u={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"};const v=u;var y=t(5419);function m(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){_(e,a,t[a])}))}return e}function _(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var b=function(e,a){var t=m({},e,a.attrs);return(0,l.bF)(y.A,m({},t,{icon:v}),null)};b.displayName="CopyOutlined",b.inheritAttrs=!1;const k=b;var f=t(7302);const A=(0,l.pM)({name:"ApiKeyManager",components:{PlusOutlined:p.A,CopyOutlined:k},setup(){const e=(0,d.KR)([]),a=(0,d.KR)(!1),t=(0,d.KR)(!1),i=(0,d.KR)(!1),r=(0,d.KR)(!1),o=(0,d.KR)(!1),n=(0,d.KR)(null),s=(0,d.KR)(""),p=(0,d.KR)(null),u=(0,d.KR)(null),v=[{title:"ID",dataIndex:"id",key:"id"},{title:"名称",dataIndex:"name",key:"name"},{title:"API密钥",dataIndex:"key",key:"key"},{title:"状态",dataIndex:"is_active",key:"is_active"},{title:"创建时间",dataIndex:"created_at",key:"created_at"},{title:"调用次数",dataIndex:"call_count",key:"call_count"},{title:"操作",dataIndex:"action",key:"action"}],y=(0,d.Kh)({name:"",description:"",expires_at:null,allowed_ips:"",rate_limit_override:null,is_active:!0}),m={name:[{required:!0,message:"请输入API密钥名称",trigger:"blur"}]},_=(0,l.h)(k,{onClick:()=>{navigator.clipboard.writeText(s.value).then((()=>c.Ay.success("API密钥已复制到剪贴板"))).catch((()=>c.Ay.error("复制失败，请手动复制")))}}),b=async()=>{a.value=!0;try{const a=await(0,f.PX)();e.value=a.data.api_keys}catch(t){console.error("获取API密钥列表失败:",t),c.Ay.error("获取API密钥列表失败")}finally{a.value=!1}},A=()=>{h(),t.value=!0},F=e=>{h(),n.value=e.id,y.name=e.name,y.description=e.description||"",y.expires_at=e.expires_at?new Date(e.expires_at):null,y.allowed_ips=e.allowed_ips||"",y.rate_limit_override=e.rate_limit_override,y.is_active=e.is_active,i.value=!0},h=()=>{y.name="",y.description="",y.expires_at=null,y.allowed_ips="",y.rate_limit_override=null,y.is_active=!0,n.value=null},g=async()=>{try{await p.value.validate(),o.value=!0;const e={name:y.name,description:y.description,is_active:y.is_active};y.expires_at&&(e.expires_at=y.expires_at.toISOString()),y.allowed_ips&&(e.allowed_ips=y.allowed_ips),y.rate_limit_override&&(e.rate_limit_override=y.rate_limit_override);const a=await(0,f.Iq)(e);s.value=a.data.api_key,t.value=!1,r.value=!0}catch(e){e.response&&e.response.data?c.Ay.error(e.response.data.error||"创建API密钥失败"):e.message?console.error("表单验证失败",e):c.Ay.error("创建API密钥失败")}finally{o.value=!1}},w=async()=>{try{await u.value.validate(),o.value=!0;const e={name:y.name,description:y.description,is_active:y.is_active};y.expires_at&&(e.expires_at=y.expires_at.toISOString()),y.allowed_ips&&(e.allowed_ips=y.allowed_ips),y.rate_limit_override&&(e.rate_limit_override=y.rate_limit_override),await(0,f.XW)(n.value,e),c.Ay.success("更新API密钥成功"),i.value=!1,b()}catch(e){e.response&&e.response.data?c.Ay.error(e.response.data.error||"更新API密钥失败"):e.message?console.error("表单验证失败",e):c.Ay.error("更新API密钥失败")}finally{o.value=!1}},K=async e=>{a.value=!0;try{await K(e.id),c.Ay.success(`API密钥 ${e.name} 已删除`),b()}catch(t){t.response&&t.response.data?c.Ay.error(t.response.data.error||"删除API密钥失败"):c.Ay.error("删除API密钥失败")}finally{a.value=!1}},I=e=>{navigator.clipboard.writeText(e.key).then((()=>c.Ay.success("API密钥已复制到剪贴板"))).catch((()=>c.Ay.error("复制失败，请手动复制")))},P=()=>{r.value=!1,b(),c.Ay.success("API密钥创建成功")};return(0,l.sV)((()=>{b()})),{apiKeys:e,loading:a,columns:v,apiKeyForm:y,rules:m,createModalVisible:t,editModalVisible:i,keyDisplayModalVisible:r,modalLoading:o,newApiKey:s,copyAddon:_,createFormRef:p,editFormRef:u,showCreateModal:A,showEditModal:F,handleCreateApiKey:g,handleUpdateApiKey:w,deleteApiKey:K,copyApiKey:I,handleApiKeyCopied:P}}});var F=t(4093);const h=(0,F.A)(A,[["render",s],["__scopeId","data-v-29741828"]]),g=h},5870:(e,a,t)=>{t.d(a,{A:()=>c});var l=t(6254),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"};const r=i;var o=t(5419);function n(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){s(e,a,t[a])}))}return e}function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var d=function(e,a){var t=n({},e,a.attrs);return(0,l.bF)(o.A,n({},t,{icon:r}),null)};d.displayName="PlusOutlined",d.inheritAttrs=!1;const c=d},7302:(e,a,t)=>{t.d(a,{Iq:()=>o,PX:()=>r,XW:()=>n});var l=t(6357);const i="",r=async()=>{try{const e=`${i}/api/v1/api-keys`;console.log(`正在请求API密钥列表: ${e}`);const a=await l.A.get(e);return a.data&&a.data.api_keys?a.data.api_keys:[]}catch(e){throw console.error("获取API密钥列表失败:",e),e.response&&(console.error("响应状态:",e.response.status),console.error("响应数据:",e.response.data)),e}},o=e=>l.A.post("/v1/api-keys/create",e),n=(e,a)=>l.A.put(`/v1/api-keys/${e}/update`,a)}}]);
//# sourceMappingURL=232.js.map