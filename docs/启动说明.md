# Qwen-VL-Chat 服务启动说明

## 启动脚本总览

本项目包含多个启动脚本，根据不同需求选择合适的脚本：

| 脚本名称 | 语言 | 主要功能 | 推荐指数 |
|---------|------|---------|---------|
| `start_all_services.bat` | 中文 | 一键启动，提供快速/完整启动选项 | ⭐⭐⭐⭐⭐ |
| `start_simple.bat` | 英文 | 功能同上，英文界面 | ⭐⭐⭐⭐⭐ |
| `fix_and_start.bat` | 英文 | 直接方式启动并加载模型，解决加载问题 | ⭐⭐⭐⭐ |
| `start_and_load.bat` | 中文 | 后台启动服务并触发模型加载 | ⭐⭐⭐ |
| `start_api_service.bat` | 中文 | 提供多种启动选项，包括修复模式 | ⭐⭐⭐ |
| `start_service.bat` | 中文 | 最简单的启动方式 | ⭐⭐ |

## 推荐启动方法

### 方法一：一键启动（推荐）

使用 `start_all_services.bat`（中文界面）或 `start_simple.bat`（英文界面）：

1. 双击运行脚本
2. 根据提示选择启动模式：
   - 选项1：**快速启动** - 只启动API服务，不预加载模型。首次请求时会自动加载模型，但响应会较慢
   - 选项2：**完整启动** - 预加载模型并启动API服务，推荐使用此选项以获得最佳体验
   - 选项3：退出程序

### 方法二：修复模式启动（解决模型加载问题）

如果遇到模型加载问题，请使用 `fix_and_start.bat`：

1. 双击运行脚本
2. 脚本会使用已知可行的方法直接启动服务并加载模型

## 各启动脚本详细说明

### 1. `start_all_services.bat`（⭐⭐⭐⭐⭐）
- **语言**：中文界面
- **功能**：整合了所有功能的一键启动脚本
- **特点**：
  - 提供快速启动和完整启动两种模式
  - 在后台加载模型并记录日志
  - 自动检查CUDA可用性
- **适用场景**：日常使用的主要脚本

### 2. `start_simple.bat`（⭐⭐⭐⭐⭐）
- **语言**：英文界面
- **功能**：与 `start_all_services.bat` 完全相同
- **特点**：英文界面，适合非中文用户
- **适用场景**：功能与 `start_all_services.bat` 相同，只是界面语言不同

### 3. `fix_and_start.bat`（⭐⭐⭐⭐）
- **语言**：英文界面
- **功能**：使用已知可行的方法直接启动服务并加载模型
- **特点**：
  - 直接使用Django shell初始化模型
  - 绕过常规加载流程，更可靠
- **适用场景**：遇到模型加载问题时使用

### 4. `start_and_load.bat`（⭐⭐⭐）
- **语言**：中文界面
- **功能**：后台启动服务并触发模型加载
- **特点**：
  - 在后台启动Django服务
  - 发送测试请求触发模型加载
  - 关闭脚本窗口不会停止服务
- **适用场景**：希望服务在后台持续运行

### 5. `start_api_service.bat`（⭐⭐⭐）
- **语言**：中文界面
- **功能**：提供多种API服务启动选项
- **特点**：
  - 标准启动模式
  - 修复模式（优化向量搜索和解决警告）
  - API测试模式
- **适用场景**：需要特定启动选项或测试API

### 6. `start_service.bat`（⭐⭐）
- **语言**：中文界面
- **功能**：最简单的启动方式
- **特点**：
  - 简单直接，只调用启动脚本
  - 没有额外选项
- **适用场景**：简单测试，但可能存在模型加载问题

## 常见问题

1. **模型未加载错误**
   - 现象：访问 `/api/status` 返回 `{"status": "stopped", "message": "模型未加载"...}`
   - 解决方法：
     - 使用 `start_all_services.bat` 并选择选项2完整启动
     - 或使用 `fix_and_start.bat` 直接启动

2. **服务启动但无法访问**
   - 确保使用正确的URL路径：`http://localhost:8000/api/v1/chat/completions`
   - API根路径是 `/api/`，不是根目录 `/`

3. **模型加载很慢**
   - 这是正常现象，大型模型加载需要时间，尤其是首次加载
   - 查看 `model_startup.log` 了解模型加载进度

## 日志文件

- `model_startup.log`：记录模型加载过程，可用于排查模型加载问题
- Django服务日志会直接显示在命令行窗口中

## 模型API文档

主要API端点：

- `/api/v1/chat/completions`：聊天完成接口
- `/api/analyze`：图像分析接口
- `/api/search`：知识库搜索接口
- `/api/status`：服务状态接口 